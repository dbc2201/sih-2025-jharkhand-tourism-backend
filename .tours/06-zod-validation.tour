{
  "$schema": "https://aka.ms/codetour-schema",
  "title": "06. Request Validation with Zod",
  "description": "Learn how Zod schemas validate incoming request data.",
  "steps": [
    {
      "file": "src/validation/index.ts",
      "line": 1,
      "title": "What is Zod?",
      "description": "## Request Validation with Zod\n\nZod is a TypeScript-first schema validation library.\n\n### Why Zod?\n- Type-safe validation\n- Automatic TypeScript types\n- Composable schemas\n- Excellent error messages\n- Zero dependencies\n\n**Validate data BEFORE it reaches your controllers!**"
    },
    {
      "file": "src/validation/schemas/auth.schema.ts",
      "line": 1,
      "title": "Validation Schemas",
      "description": "## Defining Schemas\n\nThis file contains validation schemas for authentication.\n\n### Structure:\n1. Import Zod\n2. Define schemas for each operation\n3. Export schemas and inferred types\n\n**Each API operation should have its own schema!**"
    },
    {
      "file": "src/validation/schemas/auth.schema.ts",
      "line": 10,
      "title": "Register Schema",
      "description": "## Registration Validation\n\n```typescript\nexport const registerSchema = z.object({\n  body: z.object({\n    email: z.string()\n      .email('Invalid email format'),\n    \n    password: z.string()\n      .min(8, 'Password must be at least 8 characters'),\n    \n    name: z.string()\n      .min(1, 'Name is required')\n      .max(100, 'Name too long'),\n    \n    role: z.enum(['admin', 'host', 'guide', 'customer'])\n      .optional()\n      .default('customer')\n  })\n});\n```\n\n### Validation rules:\n- `z.string()` - Must be a string\n- `.email()` - Valid email format\n- `.min(8)` - At least 8 characters\n- `.optional()` - Not required\n- `.default()` - Default value if missing"
    },
    {
      "file": "src/validation/schemas/auth.schema.ts",
      "line": 30,
      "title": "Login Schema",
      "description": "## Login Validation\n\n```typescript\nexport const loginSchema = z.object({\n  body: z.object({\n    email: z.string()\n      .email('Invalid email'),\n    \n    password: z.string()\n      .min(1, 'Password is required')\n  })\n});\n```\n\n### Simpler than register:\n- Just email and password\n- No optional fields\n- Minimal validation (server checks credentials)\n\n**Don't reveal password requirements on login!**"
    },
    {
      "file": "src/validation/schemas/auth.schema.ts",
      "line": 45,
      "title": "Type Inference",
      "description": "## Getting TypeScript Types from Schemas\n\n```typescript\nexport type RegisterDTO = z.infer<typeof registerSchema>['body'];\nexport type LoginDTO = z.infer<typeof loginSchema>['body'];\n```\n\n### Result:\n```typescript\ntype RegisterDTO = {\n  email: string;\n  password: string;\n  name: string;\n  role?: 'admin' | 'host' | 'guide' | 'customer';\n};\n```\n\n**Single source of truth:** Schema defines both validation AND types!"
    },
    {
      "file": "src/middleware/validation.middleware.ts",
      "line": 1,
      "title": "Validation Middleware",
      "description": "## The Validation Middleware\n\nThis middleware validates requests against Zod schemas.\n\n```typescript\nimport { z } from 'zod';\nimport { Request, Response, NextFunction } from 'express';\n\nexport function validate(schema: z.ZodSchema) {\n  return (req: Request, res: Response, next: NextFunction) => {\n    try {\n      schema.parse({\n        body: req.body,\n        query: req.query,\n        params: req.params\n      });\n      next();\n    } catch (error) {\n      // Handle validation errors\n    }\n  };\n}\n```\n\n**Validates body, query params, and URL params!**"
    },
    {
      "file": "src/middleware/validation.middleware.ts",
      "line": 20,
      "title": "Error Handling",
      "description": "## Handling Validation Errors\n\n```typescript\ncatch (error) {\n  if (error instanceof z.ZodError) {\n    const errors = error.errors.map(err => ({\n      field: err.path.join('.'),\n      message: err.message\n    }));\n    \n    return sendError(res, 'Validation failed', 400, errors);\n  }\n  next(error);\n}\n```\n\n### Error Response:\n```json\n{\n  \"success\": false,\n  \"message\": \"Validation failed\",\n  \"errors\": [\n    { \"field\": \"body.email\", \"message\": \"Invalid email format\" },\n    { \"field\": \"body.password\", \"message\": \"Must be at least 8 characters\" }\n  ]\n}\n```\n\n**Clear, actionable error messages!**"
    },
    {
      "file": "src/validation/schemas/common.schema.ts",
      "line": 1,
      "title": "Reusable Schema Parts",
      "description": "## Common Schema Components\n\n```typescript\n// MongoDB ObjectId validation\nexport const objectIdSchema = z.string()\n  .regex(/^[a-fA-F0-9]{24}$/, 'Invalid ID format');\n\n// Pagination parameters\nexport const paginationSchema = z.object({\n  page: z.coerce.number().min(1).default(1),\n  limit: z.coerce.number().min(1).max(100).default(10)\n});\n\n// ID in URL params\nexport const idParamSchema = z.object({\n  params: z.object({\n    id: objectIdSchema\n  })\n});\n```\n\n### Benefits:\n- DRY (Don't Repeat Yourself)\n- Consistent validation across endpoints\n- Easy to update in one place"
    },
    {
      "file": "src/validation/schemas/homestay.schema.ts",
      "line": 1,
      "title": "Complex Nested Schemas",
      "description": "## Validating Nested Objects\n\n```typescript\nexport const createHomestaySchema = z.object({\n  body: z.object({\n    title: z.string().min(3).max(100),\n    \n    location: z.object({\n      address: z.string(),\n      district: z.string(),\n      state: z.string(),\n      coordinates: z.object({\n        lat: z.number().min(-90).max(90),\n        lng: z.number().min(-180).max(180)\n      }).optional()\n    }),\n    \n    pricing: z.object({\n      basePrice: z.number().positive(),\n      cleaningFee: z.number().nonnegative().optional(),\n      weekendPrice: z.number().positive().optional()\n    }),\n    \n    amenities: z.array(z.string()).min(1)\n  })\n});\n```\n\n**Zod handles deeply nested validation effortlessly!**"
    },
    {
      "file": "src/routes/auth/Auth.route.ts",
      "line": 36,
      "title": "Using Validation in Routes",
      "description": "## Applying Validation\n\n```typescript\nimport { validate } from '../../middleware/validation.middleware';\nimport { registerSchema, loginSchema } from '../../validation';\n\nrouter.post('/register', validate(registerSchema), register);\nrouter.post('/login', validate(loginSchema), login);\n```\n\n### The flow:\n1. Request arrives\n2. `validate(registerSchema)` runs\n3. If valid â†’ passes to `register`\n4. If invalid â†’ returns 400 with errors\n\n---\n\n## ðŸŽ‰ Tour Complete!\n\nYou now understand how Zod validates and types your API requests!"
    }
  ]
}
